# Ключевые архитектурные решения

## 1. Защита от race conditions при работе с заявками
**Решение:** Использование комбинации `DB::transaction()` и `lockForUpdate()`  
**Контекст:** При параллельных запросах от одного мастера возможна потеря данных  
**Альтернативы:** Ф
- Оптимистическая блокировка (отклонена из-за сложности обработки исключений)
- Очереди (избыточно для текущей нагрузки)
**Последствия:** Гарантированная целостность данных, но небольшое снижение производительности

## 2. Статусная модель заявки
**Решение:** Использование enum в БД со статусами: new, assigned, in_progress, done, canceled  
**Контекст:** Необходимо отслеживать жизненный цикл заявки  
**Альтернативы:** 
- Отдельная таблица статусов (избыточно для текущих требований)
- Целочисленные константы (менее читаемо)
**Последствия:** Простота понимания и валидации, легко расширять новыми статусами

## 3. Использование Laravel Policies для авторизации
**Решение:** Разграничение доступа через Policies, а не напрямую в контроллерах  
**Контекст:** Мастер должен видеть только свои заявки  
**Альтернативы:** 
- Проверки в каждом методе контроллера (нарушение DRY)
- Middleware (менее гибко для объектов)
**Последствия:** Единое место управления правами, легко тестировать

## 4. UUID или автоинкремент для ID заявок
**Решение:** Автоинкремент (стандартный Laravel подход)  
**Контекст:** Нет требований к скрытию количества заявок  
**Альтернативы:** 
- UUID (избыточно, усложняет отладку)
- Составной ключ (не нужно)
**Последствия:** Простота, быстрые JOIN-ы, читаемые URL

## 5. Обработка ошибок при параллельных запросах
**Решение:** Возврат 409 Conflict с понятным сообщением  
**Контекст:** Пользователь должен понимать, почему его запрос отклонен  
**Альтернативы:** 
- 500 Internal Error (вводит в заблуждение)
- 200 OK с сообщением в теле (нарушает семантику HTTP)
**Последствия:** Понятный API, правильное использование HTTP статусов

## 6. Валидация на уровне БД и приложения
**Решение:** Двойная валидация (FormRequest + ограничения в БД)  
**Контекст:** Критически важные данные не должны повреждаться  
**Альтернативы:** 
- Только валидация в контроллере (риск обхода)
- Только БД (менее информативные ошибки)
**Последствия:** Максимальная защита данных, понятные сообщения пользователю

## 7. SoftDeletes для заявок
**Решение:** Не использовать SoftDeletes, реальное удаление  
**Контекст:** Заявки должны удаляться полностью (юридические требования)  
**Альтернативы:** 
- SoftDeletes (проще восстановление)
- Архивирование в отдельную таблицу (сложнее)
**Последствия:** Меньше данных в основной таблице, соответствие требованиям

